<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="CarrotDownload.Maui.Views.AddSeqDialog"
             xmlns:controls="clr-namespace:CarrotDownload.Maui.Controls"
             BackgroundColor="#80000000"
             Title="Add Files to Playlist">

    <Grid>
        <!-- Dialog Container -->
        <Border BackgroundColor="White"
                StrokeShape="RoundRectangle 8"
                Stroke="#e0e0e0"
                StrokeThickness="1"
                Padding="30"
                WidthRequest="600"
                HorizontalOptions="Center"
                VerticalOptions="Center">
            
            <VerticalStackLayout Spacing="20">
                <!-- Header with close button -->
                <Grid ColumnDefinitions="*,Auto">
                    <Label Text="Add Files to Playlist"
                           FontSize="20"
                           FontAttributes="Bold"
                           TextColor="#333"
                           HorizontalOptions="Center"
                           Grid.Column="0"/>
                    <Button Text="âœ•"
                            Grid.Column="1"
                            BackgroundColor="Transparent"
                            TextColor="#666"
                            FontAttributes="Bold"
                            FontSize="18"
                            Padding="0"
                            WidthRequest="32"
                            HeightRequest="32"
                            Clicked="OnCancelClicked"/>
                </Grid>

                <!-- File Selection with drag-and-drop support -->
                <VerticalStackLayout Spacing="10">
                    <!-- Drop zone (shown until a file is selected) -->
                    <Border x:Name="DropZoneBorder"
                            Stroke="#d0d0d0"
                            StrokeThickness="2"
                            StrokeDashArray="5,5"
                            StrokeShape="RoundRectangle 8"
                            BackgroundColor="#fafafa"
                            Padding="30,20">
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnSelectFileClicked"/>
                            <DropGestureRecognizer AllowDrop="True"
                                                   Drop="OnFilesDropped"/>
                        </Border.GestureRecognizers>
                        <VerticalStackLayout Spacing="8" HorizontalOptions="Center" InputTransparent="True">
                            <Label Text="ðŸ“" FontSize="32" HorizontalOptions="Center" InputTransparent="True"/>
                            <Label Text="Drop file here or click to upload"
                                   FontSize="14"
                                   TextColor="#666"
                                   HorizontalOptions="Center"
                                   HorizontalTextAlignment="Center"
                                   InputTransparent="True"/>
                        </VerticalStackLayout>
                    </Border>

                    <!-- Selected file preview (shown after selection) -->
                    <Border x:Name="SelectedPreviewBorder"
                            IsVisible="False"
                            Stroke="#e0e0e0"
                            StrokeThickness="1"
                            StrokeShape="RoundRectangle 8"
                            BackgroundColor="#ffffff"
                            Padding="15">
                        <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto">
                            <Label x:Name="SelectedFileLabel"
                                   Grid.Row="0"
                                   Grid.Column="0"
                                   Text="No file selected"
                                   FontSize="12"
                                   TextColor="#666"
                                   LineBreakMode="TailTruncation"/>

                            <Button Text="âœ•"
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    BackgroundColor="Transparent"
                                    TextColor="#666"
                                    FontAttributes="Bold"
                                    FontSize="16"
                                    Padding="0"
                                    WidthRequest="32"
                                    HeightRequest="32"
                                    Clicked="OnClearSelectedFileClicked"/>

                            <!-- Video thumbnail preview (generated via FFmpeg) -->
                            <Border Grid.Row="1"
                                    Grid.Column="0"
                                    Grid.ColumnSpan="2"
                                    BackgroundColor="#1a1a1a"
                                    StrokeShape="RoundRectangle 6"
                                    HeightRequest="140">
                                <Grid>
                                    <Image x:Name="SelectedThumbnailImage"
                                           Aspect="AspectFill"/>
                                    <Label Text="â–¶"
                                           FontSize="48"
                                           TextColor="White"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center"
                                           Opacity="0.7"/>
                                </Grid>
                            </Border>

                            <Button Text="Play"
                                    Grid.Row="2"
                                    Grid.Column="0"
                                    Grid.ColumnSpan="2"
                                    BackgroundColor="#1a1a1a"
                                    TextColor="White"
                                    CornerRadius="6"
                                    HeightRequest="40"
                                    Clicked="OnPlaySelectedClicked"/>
                        </Grid>
                    </Border>
                </VerticalStackLayout>

                <!-- Slot Position Input (optional; applied when adding a single file) -->
                <VerticalStackLayout Spacing="5">
                    <Label Text="Slot position (a-z, optional)" FontSize="14" TextColor="#333"/>
                    <Border Stroke="#cccccc"
                            StrokeThickness="1"
                            StrokeShape="RoundRectangle 4"
                            BackgroundColor="White"
                            Padding="8,0"
                            Margin="1">
                        <controls:BorderlessEntry x:Name="SlotPositionEntry"
                                                 Placeholder="Enter slot (a-z)"
                                                 MaxLength="1"
                                                 BackgroundColor="Transparent"
                                                 TextColor="#333"/>
                    </Border>
                </VerticalStackLayout>

                <!-- Privacy Options -->
                <HorizontalStackLayout Spacing="15" HorizontalOptions="Center">
                    <RadioButton x:Name="PrivateRadio"
                                Content="Private"
                                TextColor="#333"
                                IsChecked="True"/>
                    <RadioButton x:Name="PublicRadio"
                                Content="Public"
                                TextColor="#333"/>
                </HorizontalStackLayout>

                <!-- Buttons -->
                <HorizontalStackLayout Spacing="15" HorizontalOptions="Center" Margin="0,10,0,0">
                    <Button Text="Add Seq"
                            BackgroundColor="#2196F3"
                            TextColor="White"
                            BorderColor="#e0e0e0"
                            BorderWidth="1"
                            FontSize="14"
                            FontAttributes="Bold"
                            CornerRadius="4"
                            HeightRequest="40"
                            WidthRequest="120"
                            Clicked="OnAddSeqClicked"/>
                    
                    <Button Text="Cancel"
                            BackgroundColor="#6c757d"
                            TextColor="White"
                            BorderColor="#e0e0e0"
                            BorderWidth="1"
                            FontSize="14"
                            CornerRadius="4"
                            HeightRequest="40"
                            WidthRequest="120"
                            Clicked="OnCancelClicked"/>
                </HorizontalStackLayout>
            </VerticalStackLayout>
        </Border>
    </Grid>

</ContentPage>
