<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:services="clr-namespace:CarrotDownload.Maui.Services"
             xmlns:controls="clr-namespace:CarrotDownload.Maui.Controls"
             x:Class="CarrotDownload.Maui.Controls.NotificationOverlay"
             InputTransparent="False"
             VerticalOptions="End"
             HorizontalOptions="End"
             Padding="20"
             ZIndex="999">

    <ContentView.Resources>
        <controls:TypeToIconConverter x:Key="TypeToIconConverter" />
    </ContentView.Resources>
    
    <VerticalStackLayout BindableLayout.ItemsSource="{x:Static services:NotificationService.Notifications}"
                         Spacing="10"
                         WidthRequest="380">
        <BindableLayout.ItemTemplate>
            <DataTemplate x:DataType="services:NotificationMessage">
                <Border BackgroundColor="{Binding BackgroundColor}"
                        StrokeThickness="1"
                        Stroke="{Binding BorderColor}"
                        StrokeShape="RoundRectangle 12"
                        Padding="16,14"
                        Margin="0,0,0,8"
                        InputTransparent="False">
                    <Border.Shadow>
                        <Shadow Brush="Black" Offset="0,6" Radius="16" Opacity="0.12"/>
                    </Border.Shadow>
                    
                    <Grid ColumnDefinitions="Auto, *, Auto" ColumnSpacing="12">
                        <!-- Icon -->
                        <Border Grid.Column="0"
                                BackgroundColor="{Binding IconBackgroundColor}"
                                StrokeThickness="0"
                                StrokeShape="RoundRectangle 20"
                                WidthRequest="40"
                                HeightRequest="40"
                                VerticalOptions="Start">
                            <Label Text="{Binding Type, Converter={StaticResource TypeToIconConverter}}" 
                                   TextColor="{Binding IconColor}" 
                                   FontSize="20" 
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center"/>
                        </Border>
                        
                        <!-- Message -->
                        <Label Grid.Column="1"
                               Text="{Binding Message}"
                               TextColor="{Binding TextColor}"
                               FontSize="14"
                               FontAttributes="None"
                               VerticalOptions="Center"
                               LineBreakMode="WordWrap"
                               MaxLines="3"/>
                        
                        <!-- Close Button -->
                        <Button Grid.Column="2"
                                Text="âœ•"
                                TextColor="{Binding CloseButtonColor}"
                                BackgroundColor="Transparent"
                                FontSize="18"
                                FontAttributes="Bold"
                                WidthRequest="32"
                                HeightRequest="32"
                                CornerRadius="16"
                                Padding="0"
                                Margin="0"
                                BorderWidth="0"
                                VerticalOptions="Start"
                                Command="{Binding CloseCommand}"/>
                    </Grid>
                </Border>
            </DataTemplate>
        </BindableLayout.ItemTemplate>
    </VerticalStackLayout>
</ContentView>
